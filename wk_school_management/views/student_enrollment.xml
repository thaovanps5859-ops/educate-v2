<?xml version="1.0" encoding="utf-8"?>
<!-- Copyright (c) 2016-Present Webkul Software Pvt. Ltd. (<https://webkul.com/>) -->
<!-- See LICENSE file for full copyright and licensing details. -->
<!-- License URL : https://store.webkul.com/license.html/ -->
<odoo>

    <data>
        <record id="student_enrollment_form" model="ir.ui.view">
            <field name="name">student.enrollment.form</field>
            <field name="model">student.enrollment</field>
            <field name="arch" type="xml">
                <form string="Enrollment Form">
                    <header>
                        <button name="confirm_enrollment" string="Start Now" type="object" class="oe_highlight" invisible="state != 'draft'"  confirm="Are you sure you want to start this enrollment?"/>
                        <button name="complete_enrollment" string="Complete" type="object" class="oe_highlight" invisible="state != 'progress'"  confirm="Are you sure you want to complete this enrollment?"/>
                        <button name="cancel_enrollment" string="Cancel" type="object" invisible="state != 'draft' or (id == False) " confirm="Are you sure you want to cancel this enrollment?"/>
                        <button name="promote_enrollment" string="Promote Now" type="object" class="oe_highlight" invisible="state != 'complete' or (id == False)" context="{'default_name':'single'}"/>
                        <button name="terminate_enrollment" string="Terminate" type="object" invisible="state != 'complete' or (id == False)"/>
                        <button name="reset_enrollment" string="Reset" type="object" invisible="state not in ('progress','complete') or (id == False)" confirm="Are you sure you want to reset this enrollment?"/>
                        <field name="state" widget="statusbar" statusbar_visible="draft,progress,complete"/>
                    </header>
                    <sheet>
                        <div class="oe_button_box" name="button_box" invisible = "id == False">
                            <button name="get_fee_slips" icon="fa-list-ul" type="object" 
                                class="oe_stat_button" invisible="fee_slip_count == 0">
                                    <div class="o_stat_info">
                                        <span class="o_stat_value">
                                            <field name="fee_slip_count"/>
                                        </span>
                                        <span class="o_stat_text">
                                            Fee Slips
                                        </span>
                                    </div>
                            </button>
                            <button name="get_assignments" icon="fa-indent" type="object" class="oe_stat_button">
                                <div class="o_stat_info">
                                    <span class="o_stat_value">
                                        <field name="assignment_count"/>
                                    </span>
                                    <span class="o_stat_text">
                                        Assignments
                                    </span>
                                </div>
                            </button>
                            <button name="get_reports" icon="fa-check-square-o" 
                                type="object" class="oe_stat_button" invisible="not student_subject_ids">
                                <div class="o_stat_info">
                                    <span class="o_stat_text">
                                        Reports
                                    </span>
                                </div>
                            </button>
                        </div>
                        <div class="oe_title" invisible="name =='New'">
                            <h1>
                                <field name="name" readonly="1"/>
                            </h1>
                        </div>
                        <field name="student_image" widget='image' class='oe_avatar' readonly="state != 'draft'"/>
                        <group name="student_enrollment_header" string="Student Information">
                            <group >
                                <field name="student_id" readonly="state != 'draft'"/>
                                <field name="session_id" readonly="state != 'draft'" options="{'no_create_edit': True, 'no_create': True, 'no_edit': True}" />
                                <field name='fee_structure_id' readonly="state != 'draft'" options="{'no_create_edit': True, 'no_create': True, 'no_edit': True}"/>
                                <field name="session_status" widget='badge' decoration-success="session_status =='complete'" decoration-warning="session_status =='progress'" decoration-primary="session_status =='new'"/>
                                <field name="enrollment_date" readonly="state != 'draft'" />
                                <field name="total_hours" invisible="1"/>
                                <field name= "application_form_id" invisible="1"/>
                            </group>
                            <group name="enrollment_order_details">
                                <field name="grade_id" readonly="state != 'draft'" options="{'no_create_edit': True, 'no_create': True, 'no_edit': True}" />
                                <field name="section_id" readonly="state != 'draft'" invisible="not section_visibility" options="{'no_create_edit': True, 'no_create': True, 'no_edit': True}" />
                                <field name="academic_year_id" readonly="state != 'draft'" options="{'no_create_edit': True, 'no_create': True, 'no_edit': True}" />
                                <field name="fee_status" widget='badge' decoration-success="fee_status =='fully'" decoration-warning="fee_status =='partially'" decoration-info="fee_status =='overdue'" decoration-primary="fee_status =='to_pay'"/>
                                <field name="company_id" readonly="is_single_company" options="{'no_create_edit': True, 'no_create': True, 'no_edit': True}" groups="base.group_multi_company"/>
                                <field name="qr_code" widget="image" invisible="1"/>
                                <field name="approved_hours" invisible="1"/>
                                <field name="fee_slip_count" invisible="1"/>
                            </group>
                        </group>
                        <notebook>
                            <page string='Subjects'>
                                <button name="add_subjects" string="Add Subjects" type="object" class="oe_highlight" invisible="state != 'draft'"/>
                                <field name='student_subject_ids' widget="one2many" readonly="state != 'draft'">
                                    <list editable='bottom'>
                                        <field name="subject_id" options="{'no_create_edit': True, 'no_create': True, 'no_edit': True}"/>
                                        <field name="subject_code"/>
                                        <field name="credit_value"/>
                                        <field name="grade_id" optional='show'/>
                                        <field name="session_id" optional='hide'/>
                                        <field name="academic_year_id"/>
                                        <field name="total_assignments"/>
                                        <field name="scale_line_id"/>
                                        <field name="create_uid" optional='hide'/>
                                        <field name="create_date" optional='hide'/>
                                        <field name="state" widget="badge" decoration-primary="state=='draft'" decoration-success="state=='complete'" decoration-warning="state =='progress'" />
                                    </list>
                                </field>
                            </page>
                            <page name="fee_summary" string="Fee Summary">
                                <div>
                                    <button string="Generate Fee Slips" name="generate_schedule_fees" title="Generate Fee Slips"
                                        icon="fa-refresh" type="object" class="oe_inline oe_highlight mb-3"
                                        invisible="not (state == 'progress' and (not fee_slip_ids or total_amount != generated_amount))"/>
                                </div>
                                <group>
                                    <group>
                                        <field name="total_amount" string="Total Fee Amount"/>
                                        <field name="paid_amount" string="Paid Amount"/>
                                        <field name="due_amount" string="Due Amount"/>
                                    </group>
                                    <group>
                                        <field name="generated_amount" string="Generated Fee Amount"/>
                                        <field name="payment_term" readonly="1"/>
                                        <field name="installment" invisible="payment_term != 'custom'" readonly="1"/>
                                    </group>
                                </group>
                                <group name="fee_summary_info">
                                    <field name="fee_summary_ids" nolabel="1">
                                        <list string="Fee Summary" editable="bottom">
                                            <field name="sequence" widget="handle"/>
                                            <field name="product_id" options="{'no_create_edit': True, 'no_create': True, 'no_edit': True}"/>
                                            <field name="fee" sum="Total"/>
                                            <field name="frequency"/>
                                            <field name="amount_paid" sum="Total"/>
                                            <field name="create_date" optional='hide'/> 
                                            <field name="write_date" optional='hide'/>  
                                        </list>
                                    </field>
                                </group>
                            </page>
                            <page string="Service Hours" invisible="state != 'progress'">
                                <field name="service_hour_ids" readonly="1"/>
                            </page>
                            <page string="Discipline" invisible="state != 'progress'">
                                <field name="discipline_ids" readonly="1"/>
                            </page>
                            <page string="Scholarships" invisible="state != 'progress'">
                                <field name="scholarship_ids" readonly="1">
                                    <list string="Scholarship">
                                        <field name="name" string="Sequence"/>
                                        <field name="scholarship_amount" sum="Total"/>
                                        <field name="paid_date" optional="hide"/>
                                        <field name="create_date"/>
                                        <field name="write_uid"/>
                                        <field name="write_date" optional="hide"/>
                                        <field name="company_id" optional="hide"/>
                                        <field name="currency_id" optional="hide"/>
                                        <field name="create_uid" optional="hide"/>
                                        <field name="invoice_status" widget="badge" optional="show"/>
                                        <field name="state" widget="badge" decoration-primary="state =='new'" 
                                            decoration-danger="state =='cancel'" decoration-success="state =='paid'"
                                            decoration-warning="state =='progress'" decoration-info="state=='approve'"/>
                                    </list>
                                </field>
                            </page>
                        </notebook>
                    </sheet>
                    <chatter/>
                </form>
            </field>
        </record>

        <record id="student_enrollment_form_tree" model="ir.ui.view">
            <field name="name">student.enrollment.list</field>
            <field name="model">student.enrollment</field>
            <field name="arch" type="xml">
                <list string="Enrollment Form">
                    <field name="name"/>
                    <field name="student_id"/>
                    <field name="session_id"/>
                    <field name="grade_id"/>
                    <field name="section_id" optional="hide"/>
                    <field name="company_id" groups="!base.group_multi_company" column_invisible="True"/>
                    <field name="company_id"
                        groups="base.group_multi_company"
                        optional="show"
                        readonly="1"/>
                    <field name="enrollment_date"/>
                    <field name="total_amount" optional="hide" />
                    <field name="paid_amount" optional="hide" />
                    <field name="generated_amount" optional="hide" />
                    <field name="due_amount" optional="hide" />
                    <field name="create_date"/>
                    <field name="state" string="Status" widget='badge'
                        decoration-danger="state=='cancel'" 
                        decoration-success="state=='complete'" 
                        decoration-warning="state =='progress'" 
                        decoration-primary="state =='draft'"
                        decoration-info="state == 'promote'"/>
                    <field name="session_status" optional="hide" widget='badge'
                        decoration-success="session_status =='complete'" 
                        decoration-warning="session_status =='progress'" 
                        decoration-primary="session_status =='new'"/>
                    <field name="create_uid" optional="hide" />
                    <field name="write_date" optional="hide" />
                    <field name="write_uid" optional="hide" />
                </list>
            </field>
        </record>

        <record id="student_enrollment_form_kanban" model="ir.ui.view">
            <field name="name">student.enrollment.kanban</field>
            <field name="model">student.enrollment</field>
            <field name="arch" type="xml">
               <kanban>
                    <field name='student_id'/>
                    <field name='grade_id'/>
                    <field name='session_id'/>
                    <templates>
                        <t t-name="card" class="flex-row">
                            <aside class="o_kanban_aside_full">
                                <field name="student_image" class="o_kanban_image_fill w-100" widget="image" options="{'img_class': 'object-fit-cover'}" alt="Student image"/>
                            </aside>
                            <main class="o_kanban_details flex-grow-1">
                                <div class="o_kanban_record_top">
                                    <div class="o_kanban_record_headings">
                                        <strong class="o_kanban_record_title">
                                            <field name="student_id"/>
                                        </strong>
                                        <span style="float:right;">
                                            <field name="state" widget="label_selection" options="{'classes': {'draft': 'info', 'cancel': 'danger','progress':'warning', 'complete': 'success'}}"/>
                                        </span>
                                    </div>
                                </div>
                                <div t-if="record.name.raw_value">
                                    <span class="fw-normal">Enrollment No.: </span>
                                    <strong><field name="name"/></strong>
                                </div>
                                <div t-if="record.grade_id.raw_value">
                                    <span class="fw-normal">Grade: </span>
                                    <strong><field name="grade_id"/></strong>
                                </div>
                                <div t-if="record.session_id.raw_value">
                                    <span class="fw-normal">Session: </span>
                                    <strong><field name="session_id"/></strong>
                                </div>
                                <div t-if="record.academic_year_id.raw_value">
                                    <span class="fw-normal">Academic Year: </span>
                                    <strong><field name="academic_year_id"/></strong>
                                </div>
                            </main>
                        </t>
                    </templates>
                </kanban>
            </field>
        </record>

        <record id="student_enrollment_search" model="ir.ui.view">
           <field name="name">student.enrollment.search</field>
           <field name="model">student.enrollment</field>
           <field name="arch" type="xml">
               <search>
                    <field name="name" string="Enrollment For" filter_domain="['|','|','|', ('student_id', 'ilike', self), ('name', 'ilike', self),('grade_id', 'ilike', self),('company_id','ilike','self')]"/>
                    <filter name="todays_enrollments" string="Today" domain="[('enrollment_date','=',context_today())]" />
                    <filter string="Current Month" name="current_month_enroll" domain="[('enrollment_date','&lt;',(context_today()+relativedelta(months=1)).strftime('%%Y-%%m-01')), ('enrollment_date','&gt;=',time.strftime('%%Y-%%m-01'))]"/>
                    <filter string="Enrollment Date" name="enrollment_date" date="enrollment_date"/>
                    <separator/>
                    <filter name="to_do" string="To Do" domain="['|',('state','=','draft'),('state','=','progress')]"/>
                    <filter name="draft" string="Draft" domain="[('state','=','draft')]"/>
                    <filter name="progress" string="In Progress" domain="[('state','=','progress')]"/>
                    <filter name="complete" string="Completed" domain="[('state','=','complete')]"/>
                    <filter name="promote" string="Promoted" domain="[('state','=','promote')]"/>
                    <filter name="terminate" string="Terminated" domain="[('state','=','terminate')]"/>
                    <filter name="cancel" string="Cancelled" domain="[('state','=','cancel')]"/>
                    <group expand="0" string="Group by...">
                        <filter name="group_by_student"  string="Student" domain="[]" context="{'group_by':'student_id'}" />
                        <filter name="group_by_state"  string="Status" domain="[]" context="{'group_by':'state'}" />
                        <filter name="group_by_grade"  string="Grade" domain="[]" context="{'group_by':'grade_id'}" />
                        <filter name="group_by_session"  string="Session" domain="[]" context="{'group_by':'session_id'}" />
                        <filter name="group_by_academic_year"  string="Academic Year" domain="[]" context="{'group_by':'academic_year_id'}" />
                        <filter name="enrollment_month" string="Enrollment Date" domain="[]" context="{'group_by': 'enrollment_date'}"/>
                        <filter name="group_by_school"  string="School" domain="[]" context="{'group_by':'company_id'}" />
                    </group>
               </search>
           </field>
        </record>

        <record id="student_enrollment_graph_view" model="ir.ui.view">
            <field name="name">student.enrollment.view.graph</field>
            <field name="model">student.enrollment</field>
            <field name="arch" type="xml">
                <graph string="New Enrollments Over Time" type="bar" sample="1">
                    <field name="grade_id"/>
                    <field name="enrollment_date" interval="month"/>
                </graph>
            </field>
        </record>

        <record id="student_enrollment_calendar_view" model="ir.ui.view">
            <field name="name">student.enrollment.calendar</field>
            <field name="model">student.enrollment</field>
            <field name="arch" type="xml">
                <calendar string="Enrollment" create="0" delete="0" mode="month" date_start="enrollment_date" event_open_popup='True' color="state" >
                    <field name="student_id"/>
                    <field name="state" color="kanban_color" />
                </calendar>
            </field>
        </record>

        <record id="view_student_enrollment_pivot" model="ir.ui.view">
            <field name="name">student.enrollment.pivot</field>
            <field name="model">student.enrollment</field>
            <field name="arch" type="xml">
                <pivot string="Enrollment Analysis">
                    <field name="grade_id" type="row"/>
                    <field name="academic_year_id" type="row"/>
                    <field name="payment_term" type="row"/>
                    <field name="fee_status" type="row"/>

                    <field name="total_amount" type="measure"/>
                    <field name="paid_amount" type="measure"/>
                    <field name="due_amount" type="measure"/>
                    <field name="generated_amount" type="measure"/>
                    <field name="total_hours" type="measure"/>
                    <field name="approved_hours" type="measure"/>
                </pivot>
            </field>
        </record>


        <record id="enrollment_form_action" model="ir.actions.act_window">
            <field name="name">Enrollment Form</field>
            <field name="res_model">student.enrollment</field>
            <field name="view_mode">form,list,kanban,calendar,graph,pivot</field>
            <field name="path">school-enrollment</field>
            <field name="search_view_id" ref="student_enrollment_search"/>
            <field name="view_id" ref="student_enrollment_form_tree"/>
            <field name="context">{'search_default_progress': 1}</field>
        </record>

        <!-- ACTION FOR FETCHING ENROLLMENTS IN ACADEMIC YEAR -->
        <record id="get_enrollments_action" model="ir.actions.act_window">
            <field name="name">Enrollment Form</field>
            <field name="res_model">student.enrollment</field>
            <field name="view_mode">form,list,calendar,graph</field>
            <field name="path">enrollment</field>
            <field name="domain">[('academic_year_id','=',active_id)]</field>
            <field name="search_view_id" ref="student_enrollment_search"/>
            <field name="view_id" ref="student_enrollment_form_tree"/>
        </record>

        <record id="action_enroll_student" model="ir.actions.act_window">
            <field name="name">Enroll Student</field>
            <field name="res_model">student.enrollment</field>
            <field name="view_mode">form,list,calendar,graph</field>
            <field name="view_id" ref="student_enrollment_form"/>
            <field name="target">current</field>
            <field name="path">enroll-student</field>
            <field name="context">{'default_student_id': active_id}</field>
        </record>
    </data>    
</odoo>
